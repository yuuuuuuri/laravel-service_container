# CSRFとは
クロスサイトリクエストフォージェリ(Cross Site Request Forgeries)の略。
>クロスサイトリクエストフォージェリ（CSRF）とは、Webアプリケーションに存在する脆弱性、もしくはその脆弱性を利用した攻撃方法のことです。掲示板や問い合わせフォームなどを処理するWebアプリケーションが、本来拒否すべき他サイトからのリクエストを受信し処理してしまいます。
出所：[クロスサイトリクエストフォージェリ（CSRF） (TREND MICRO)](https://www.trendmicro.com/ja_jp/security-intelligence/research-reports/threat-solution/csrf.html)


例えば、ツイッターなどで攻撃者が用意した投稿のURLをクリックしてしまうと、自分の知らないところで自分のアカウントでツイートされるなどがある。
これは、クリックした先のページが正規のものでないため起こっている。

## CSRFの事件
[PC遠隔操作事件](https://ja.wikipedia.org/wiki/%E3%83%91%E3%82%BD%E3%82%B3%E3%83%B3%E9%81%A0%E9%9A%94%E6%93%8D%E4%BD%9C%E4%BA%8B%E4%BB%B6)

# CSRF対策
リクエストが送られてきたページが、正しいものか信頼できるものか確認できればよい。
先程のツイッターの例でいうならば、クリックしただ期のページが信頼できるか正しいページかを判断すればよい。
具体的にどのようにすればよいのか書いていきます(*'▽')

### ワンタイムトークンの設定
ワンタイムトークンとは、リクエストの送信元のページに対してリクエストが来るたびに渡すランダムな文字列のこと。
HTMLの<form>にトークンを埋め込む。`csrf_field`ヘルパ関数を使用する。

```php
<form class = "test" method = "POST" action = "post">
{{ csrf_field()}}
</form>
```
`app/Http/Middleware/VerifyCsrfToken`でリクエスト時に設定されたトークンとセッションごとのトークンが一致しているか判定している。


# アットコスメやBOがCSRF対策されていなかったら？？
CSRF保護していないということは、他の悪意のあるサイトからリクエストが来たのか区別していない状態となる。そうなると、どうなるのか。
アットコスメだったら、知らない間に自分が悪意のあるクチコミを投稿していたり、記事を投稿していたり…それだけならまだしもshoppingで勝手に購入されるということも起きるかもしれない。
BOも同様に記事を投稿したり、メールがユーザーに配信されてしまう、ということも起きるかもしれない。

